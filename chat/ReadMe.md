# **Конфигурация**

- **Порт:** 3000
- **Маршруты:**
    - **Чат**: /chat
    - **Сообщения**: /message

# **База данных**
Коллекции:

- **chats**
```json
{
    "_id": "ObjectId(some id)",                        
    "members": ["user_id1", "user_id2"],                
    "created_at": "2024-04-16T09:21:52.696+00:00",       
    "last_message_at" : "2024-04-16T09:21:52.696+00:00"  
}
```

- **messages**
```json
{
    "chat_id": "some id",                     
    "sender_id": "some id",                   
    "text": "text example",                   
    "created_at": "2024-04-17T09:57:18.635Z",   
    "_id": "ObjectId(some id)"       
}
```


# **Структура кода**
```
├── index.js                # Основной файл приложения
├── controllers/            # Контроллеры обработки запросов
│   └── userController.js   # Пример контроллера пользователей
├── models/                 # Модели данных для работы с MongoDB
│   └── User.js             # Пример модели пользователя
├── routes/                 # Маршруты Express.js
│   └── userRoutes.js       # Пример маршрутов для пользователей
├── services/               # Сервисы для бизнес-логики
│   └── userService.js      # Пример сервиса пользователей
├── config/                 # Конфигурационные файлы
│   ├── db.js               # Конфигурация подключения к базе данных
│   └── index.js            # Конфигурационный файл для основных параметров
├── utils/                  # Вспомогательные утилиты
│   ├── jwtUtils.js         # Функции для работы с JSON Web Tokens
│   └── helper.js           # Пример вспомогательной утилиты
├── sockets/                # Логика для работы с socket.io
│   └── index.js            # Файл для обработки событий WebSocket
├── package.json            # Файл зависимостей и настроек проекта
└── package-lock.json       # Фиксированные версии установленных пакетов
```
# **Спецификация запросов для микросервиса**

## 1. Запросы для действий над чатами

### 1.1. Создание чата
Маршрут: ```/chat/createChat```

Для создания чата и записи его в бд необходимо отправить на сервер POST-запрос следующего вида:

```json
{
    "members": ["user_id1", "user_id2"] 
}
```

Запись чата в базе данных имеет следующие поля:

```json
{
    "_id": "ObjectId(some id)",                        
    "members": ["user_id1", "user_id2"],               
    "created_at": "2024-04-16T09:21:52.696+00:00",       
    "last_message_at" : "2024-04-16T09:21:52.696+00:00"  
}
```

### 1.2. Получение всех сообщений чата
Маршрут: ```/chat/getMessages```

Для получения списка всех сообщений чата необходимо отправить GET-запрос, содержащий в заголовке ID чата.

```json
{
    "chat_id": "some id"
}
```

В ответ получаем ответ список сообщений (структуру сообщения см. подробно в пункте 2) следующего вида: 

```json
[
    {
        "_id": "some id",
        "chat_id": "some id",
        "sender_id": "some id",
        "text": "text example",
        "created_at": "2024-04-16T09:54:00.063+00:00"
    },

    {
        "_id": "some id",
        "chat_id": "some id",
        "sender_id": "some id",
        "text": "text example",
        "created_at": "2024-04-16T09:54:00.063+00:00"
    }
]
```

### 1.3. Получение всех чатов пользователя
Маршрут: ```/chat/getUserChats```

Для получения списка всех чатов для конкретного пользователя необходимо оправить GET-запрос, содержащий в заголовке ID этого пользователя.

```json
{
    "user_id": "some id"
}
```

В ответ получаем список чатов пользователя:
```json
[
    {
        "_id": "ObjectId(some id)",                        
        "members": ["user_id1", "user_id2"],                
        "created_at": "2024-04-16T09:21:52.696+00:00",       
        "last_message_at" : "2024-04-16T09:21:52.696+00:00" 
    },  

    {
        "_id": "ObjectId(some id)",                        
        "members": ["user_id1", "user_id2"],                
        "created_at": "2024-04-16T09:21:52.696+00:00",       
        "last_message_at" : "2024-04-16T09:21:52.696+00:00"
    },
]
```

### 1.4. Получение чата по его ID
Маршрут: ```/chat/getChat```

Для получения чат GET-запрос, содержащий в заголовке ID нужного чата.

```json
{
    "chat_id": "some id"
}
```

В ответ отправляются следующие данные:

```json
{
    "_id": "ObjectId(some id)",                        
    "members": ["user_id1", "user_id2"],                
    "created_at": "2024-04-16T09:21:52.696+00:00",       
    "last_message_at" : "2024-04-16T09:21:52.696+00:00"
}
```

## 2. Запросы для действий над сообщениями

### 2.1. Отправка сообщения
Маршрут: ```/message/sendMessage```

Для отправки сообщения и записи его в БД отправляется POST-запрос, содержащий в теле следующие данные:

```json
{
    "chat_id": "some id",
    "sender_id": "some id",
    "text": "text example"
}

```

Сообщение записывается в базу данных и отправляется в ответе. Запись имеет вид:

```json
{
    "chat_id": "some id",                     
    "sender_id": "some id",                   
    "text": "text example",                   
    "created_at": "2024-04-17T09:57:18.635Z",   
    "_id": "661f9cfe52089975174cd93c"          
}
```